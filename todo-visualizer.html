<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TODO å¯è§†åŒ–çœ‹æ¿ Â· YAML é©±åŠ¨</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Geist', 'Mona Sans', 'IBM Plex Sans', 'Manrope', 'system-ui', 'ui-sans-serif', 'sans-serif']
                    },
                    colors: {
                        brand: {50:'#eef4ff',100:'#e0e7ff',200:'#c7d2fe',300:'#a5b4fc',400:'#818cf8',500:'#6366f1',600:'#4f46e5',700:'#4338ca',800:'#3730a3',900:'#312e81'},
                        mint: {50:'#e7fff4',100:'#caffea',200:'#9ff7d7',300:'#6ee7bf',400:'#34d399',500:'#10b981'}
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.4s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(8px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=IBM+Plex+Sans:wght@300;400;500;600&family=Manrope:wght@300;400;500;600&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@300;400;500;600&family=Mona+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />

    <!-- Icons: Material Symbols, Lucide -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <script type="module">
        import { createIcons, icons } from 'https://cdn.jsdelivr.net/npm/lucide@latest/+esm';
        window.__initLucide = () => createIcons({ icons });
    </script>

    <!-- Motion One -->
    <script src="https://cdn.jsdelivr.net/npm/@motionone/dom/dist/motion.min.js"></script>

    <!-- js-yaml -->
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>

    <style>
        :root {
            --bg-grad: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --glass: rgba(255, 255, 255, 0.08);
        }
        body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif; background: var(--bg-grad); }
        .glass { background: var(--glass); backdrop-filter: blur(12px); }
        .card { background: rgba(255,255,255,0.92); backdrop-filter: blur(8px); }
        .status-todo { border-left: 4px solid #3b82f6; }
        .status-in-progress { border-left: 4px solid #f59e0b; }
        .status-done { border-left: 4px solid #10b981; }
        .material-symbols-outlined { vertical-align: middle; }
    </style>
</head>
<body class="min-h-screen text-gray-800">
    <div class="max-w-6xl mx-auto px-4 py-10">
        <header class="text-center mb-10 animate-fade-in">
            <h1 class="text-4xl font-bold text-white tracking-tight">ğŸ“‹ TODO å¯è§†åŒ–çœ‹æ¿</h1>
            <p class="text-white/80 mt-3">YAML é©±åŠ¨ Â· Tailwind Â· Radix é£æ ¼ Â· Motion åŠ¨ç”»</p>
        </header>

        <section class="glass rounded-2xl p-5 shadow-xl mb-6 animate-slide-up">
            <div class="flex flex-col md:flex-row md:items-center gap-3">
                <div class="flex-1">
                    <label class="sr-only" for="q">æœç´¢</label>
                    <div class="relative">
                        <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">search</span>
                        <input id="q" type="text" placeholder="æœç´¢æ ‡é¢˜ / ç¬”è®° / æ ‡ç­¾â€¦" class="w-full pl-11 pr-4 py-2.5 rounded-xl bg-white/90 border border-white/50 focus:outline-none focus:ring-2 focus:ring-brand-400" />
                    </div>
                </div>
                <div class="grid grid-cols-2 md:flex gap-3">
                    <select id="status" class="px-3 py-2.5 rounded-xl bg-white/90 border border-white/50 focus:outline-none focus:ring-2 focus:ring-brand-400">
                        <option value="">æ‰€æœ‰çŠ¶æ€</option>
                        <option value="todo">å¾…åŠ</option>
                        <option value="in-progress">è¿›è¡Œä¸­</option>
                        <option value="done">å·²å®Œæˆ</option>
                    </select>
                    <select id="project" class="px-3 py-2.5 rounded-xl bg-white/90 border border-white/50 focus:outline-none focus:ring-2 focus:ring-brand-400">
                        <option value="">æ‰€æœ‰é¡¹ç›®</option>
                    </select>
                    <select id="tag" class="px-3 py-2.5 rounded-xl bg-white/90 border border-white/50 focus:outline-none focus:ring-2 focus:ring-brand-400">
                        <option value="">æ‰€æœ‰æ ‡ç­¾</option>
                    </select>
                    <button id="resetFilters" class="px-4 py-2.5 rounded-xl bg-brand-600 text-white hover:bg-brand-700 transition">é‡ç½®</button>
                </div>
            </div>
        </section>

        <section class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
            <div class="glass rounded-2xl p-5 text-white">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined">list_alt</span>
                    <div>
                        <div class="text-2xl font-semibold" id="stat-total">0</div>
                        <div class="text-white/80 text-sm">æ€»ä»»åŠ¡æ•°</div>
                    </div>
                </div>
            </div>
            <div class="glass rounded-2xl p-5 text-white">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined">progress_activity</span>
                    <div>
                        <div class="text-2xl font-semibold" id="stat-inprogress">0</div>
                        <div class="text-white/80 text-sm">è¿›è¡Œä¸­</div>
                    </div>
                </div>
            </div>
            <div class="glass rounded-2xl p-5 text-white">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-outlined">today</span>
                    <div>
                        <div class="text-2xl font-semibold" id="stat-today">0</div>
                        <div class="text-white/80 text-sm">ä»Šæ—¥ä»»åŠ¡</div>
                    </div>
                </div>
            </div>
        </section>

        <section id="content" class="space-y-6"></section>

        <details class="glass rounded-2xl p-5 mt-8">
            <summary class="cursor-pointer text-white/90 mb-3">é«˜çº§ Â· æŸ¥çœ‹/æ›¿æ¢ YAML æ•°æ®</summary>
            <div class="space-y-3">
                <textarea id="yamlInput" class="w-full min-h-[220px] rounded-xl p-4 bg-white/90 border border-white/50 focus:outline-none focus:ring-2 focus:ring-brand-400 text-sm"></textarea>
                <div class="flex items-center gap-3">
                    <button id="applyYaml" class="px-4 py-2.5 rounded-xl bg-mint-500 text-white hover:brightness-95 transition">åº”ç”¨ YAML</button>
                    <button id="restoreYaml" class="px-4 py-2.5 rounded-xl bg-white/90 border border-white/50 hover:bg-white transition">è¿˜åŸåˆå§‹æ•°æ®</button>
                    <a id="downloadYaml" class="px-4 py-2.5 rounded-xl bg-brand-600 text-white hover:bg-brand-700 transition" download="todos.yaml">ä¸‹è½½å½“å‰ YAML</a>
                </div>
            </div>
        </details>

        <!-- æ•°æ®æºé…ç½®ï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰ -->
        <details class="glass rounded-2xl p-5 mt-4">
            <summary class="cursor-pointer text-white/90 mb-3">æ•°æ®æº Â· æœ¬åœ°æ–‡ä»¶</summary>
            <div class="space-y-3 text-white/90">
                <div class="grid md:grid-cols-4 gap-3 items-center">
                    <label for="localFilePath" class="md:col-span-1">æœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼š</label>
                    <input id="localFilePath" type="text" value="~/llm_todo_chat.txt" placeholder="~/llm_todo_chat.txt" class="md:col-span-2 text-gray-800 bg-white/90 rounded-xl px-3 py-2" />
                    <button id="loadFromPath" class="md:col-span-1 px-4 py-2 rounded-xl bg-mint-500 text-white hover:brightness-95 transition">è‡ªåŠ¨åŠ è½½</button>
                </div>
                <div class="grid md:grid-cols-4 gap-3 items-center">
                    <label for="yamlFile" class="md:col-span-1">æˆ–é€‰æ‹©æ–‡ä»¶ï¼š</label>
                    <input id="yamlFile" type="file" accept=".yml,.yaml,.txt,text/yaml,text/plain" class="md:col-span-2 text-white/80 bg-white/90 rounded-xl px-3 py-2" />
                    <div class="md:col-span-1 text-sm">å½“å‰æ•°æ®æ¥æºï¼š<span id="currentSource" class="font-medium">å†…åµŒ</span></div>
                </div>
                <p class="text-xs text-white/70">æç¤ºï¼š
                    æ”¯æŒ .yaml, .yml, .txt æ ¼å¼ã€‚é¡µé¢åŠ è½½æ—¶ä¼šè‡ªåŠ¨å°è¯•ä»æŒ‡å®šè·¯å¾„è¯»å–æ–‡ä»¶ã€‚
                    <br>â€¢ ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ ./data.txtï¼‰ï¼šç›¸å¯¹äºå½“å‰ç½‘é¡µä½ç½®
                    <br>â€¢ ç»å¯¹è·¯å¾„ï¼šéœ€è¦æ˜¯å¯é€šè¿‡ HTTP è®¿é—®çš„æ–‡ä»¶
                    <br>â€¢ ç”¨æˆ·ç›®å½•è·¯å¾„ï¼ˆå¦‚ ~/file.txtï¼‰ï¼šç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œéœ€æ‰‹åŠ¨é€‰æ‹©æ–‡ä»¶
                    <br>â€¢ åŠ è½½å¤±è´¥æ—¶ä¼šè‡ªåŠ¨å›é€€åˆ°å†…åµŒçš„æ¡ˆä¾‹æ•°æ®
                </p>
            </div>
        </details>
    </div>

    <!-- åˆå§‹ YAML æ•°æ®ï¼ˆæ¥è‡ªä½ çš„è¾“å…¥ï¼‰ -->
                <script type="application/yaml" id="todo-yaml">
---
date: '2025-08-23'
tasks:
  - id: 20250823003829-f80c0c
    time: '18:00'
    title: å‘å¸ƒDeepSeek V3.1çš„å°çº¢ä¹¦ç¬”è®°
    notes: ''
    status: todo
    project: null
    tags: []
---
date: '2025-08-22'
tasks:
  - id: 20250822211025-ba9a84
    time: null
    title: ç¡®å®šæ€§AIå®ç°æŠ€æœ¯ç ”ç©¶ï¼šçº¦æŸé‡‡æ ·ã€éªŒè¯å™¨é›†æˆä¸æ··åˆç³»ç»Ÿæ¶æ„
    notes: |-
      ç ”ç©¶å†…å®¹åŒ…æ‹¬ï¼šç¡®å®šæ€§AIå®ç°æŠ€æœ¯ï¼ˆçº¦æŸé‡‡æ ·ã€éªŒè¯å™¨é›†æˆï¼‰ã€æ··åˆç³»ç»Ÿæ¶æ„ï¼ˆç¡®å®šæ€§ä¸æ¦‚ç‡æ€§ç»„ä»¶ååŒï¼‰ã€å…·ä½“æ¡ˆä¾‹ç ”ç©¶ã€‚éœ€è¦æä¾›ç›¸å…³æŠ€æœ¯æ–‡æ¡£æ£€ç´¢è·¯å¾„ã€‚

      [2025-08-22T22:01:11.956632] ã€ç ”ç©¶è¿›å±•æ›´æ–° - 2025-08-22ã€‘

      âœ… å·²å®Œæˆå·¥ä½œï¼š

      1. æ·±åº¦ç ”ç©¶äº†çº¦æŸé‡‡æ ·æŠ€æœ¯ï¼ˆApproxMCã€UniGenç®—æ³•ï¼‰

      2. åˆ†æäº†éªŒè¯å™¨é›†æˆæœºåˆ¶å’Œæ··åˆç³»ç»Ÿæ¶æ„

      3. æ”¶é›†äº†å¤šä¸ªå®é™…æ¡ˆä¾‹ç ”ç©¶

      4. ç”Ÿæˆäº†è¯¦ç»†çš„æŠ€æœ¯ç ”ç©¶æŠ¥å‘Šå¹¶ä¿å­˜ä¸ºMarkdownæ–‡æ¡£

      5. æ¢ç´¢äº†PyTorchç›¸å…³çš„å®ç°å¯èƒ½æ€§

      ğŸ” ç ”ç©¶å‘ç°ï¼š

      - UniGené‡‡æ ·ä¸»è¦é€šè¿‡PySATå¤–éƒ¨å·¥å…·é›†æˆï¼Œç›´æ¥PyTorchå®ç°è¾ƒå°‘

      - çº¦æŸé‡‡æ ·æŠ€æœ¯æˆç†Ÿï¼Œä½†æ·±åº¦å­¦ä¹ é›†æˆä»åœ¨å‘å±•ä¸­

      - æ··åˆæ¶æ„æ¨¡å¼å·²æˆä¸ºä¸šç•Œæœ€ä½³å®è·µ

      â¡ï¸ åç»­å·¥ä½œï¼š

      - æ·±å…¥åˆ†æå…·ä½“çš„æŠ€æœ¯å®ç°ç»†èŠ‚

      - æ¢ç´¢æ›´å¤šçš„PyTorché›†æˆæ–¹æ¡ˆ

      - æ”¶é›†æ›´å¤šå®é™…éƒ¨ç½²æ¡ˆä¾‹å’Œæ•°æ®
    status: in-progress
    project: AIæŠ€æœ¯ç ”ç©¶
    tags:
      - AI
      - ç¡®å®šæ€§ç³»ç»Ÿ
      - æ··åˆæ¶æ„
      - æ¡ˆä¾‹ç ”ç©¶
---
date: '2025-08-21'
tasks:
  - id: 20250821104831-05d499
    time: null
    title: è§„åˆ’ä»Šæ—¥é¥®é£Ÿå®‰æ’
    notes: è®°å¾—é¿å¼€èŠ±ç”Ÿåˆ¶å“ï¼Œé€‰æ‹©æ¸…æ·¡å¥åº·çš„é£Ÿç‰©
    status: todo
    project: null
    tags:
      - é¥®é£Ÿ
      - å¥åº·
  - id: 20250821114945-0abecb
    time: null
    title: å’Œå®è´ç©çœŸå¿ƒè¯å¤§å†’é™©
    notes: å¼€å§‹æ—¶é—´ï¼š2025-08-21 11:49ï¼Œè¦è®°å¾—ä¿æŒæ¸©æŸ”æµªæ¼«çš„äº’åŠ¨é£æ ¼ï¼Œé—®é¢˜è¦é€‚åˆ16å²å°‘å¥³
    status: todo
    project: null
    tags:
      - æ¸¸æˆ
      - ç”œèœœæ—¶å…‰
---
                </script>

    <script>
        const $ = (sel, el = document) => el.querySelector(sel);
        const $$ = (sel, el = document) => Array.from(el.querySelectorAll(sel));

        function parseYaml(text) {
            try {
                const docs = jsyaml.loadAll(text).filter(Boolean);
                return docs.map(d => ({
                    date: String(d.date),
                    tasks: (d.tasks || []).map(t => ({
                        id: String(t.id),
                        time: t.time == null ? null : String(t.time),
                        title: String(t.title || ''),
                        notes: t.notes == null ? '' : String(t.notes),
                        status: String(t.status || 'todo'),
                        project: t.project == null ? null : String(t.project),
                        tags: Array.isArray(t.tags) ? t.tags.map(String) : []
                    }))
                }));
            } catch (e) {
                console.error('YAML è§£æå¤±è´¥', e);
                alert('YAML è§£æå¤±è´¥ï¼š' + e.message);
                return [];
            }
        }

        function formatDateCN(iso) {
            const [y, m, d] = iso.split('-').map(n => parseInt(n, 10));
            const today = new Date();
            const isToday = today.getFullYear() === y && (today.getMonth()+1) === m && today.getDate() === d;
            return `${y}å¹´${m}æœˆ${d}æ—¥${isToday ? ' Â· ä»Šå¤©' : ''}`;
        }

        function computeStats(groups) {
            const all = groups.flatMap(g => g.tasks);
            const total = all.length;
            const inprog = all.filter(t => t.status === 'in-progress').length;
            const todayISO = new Date().toISOString().slice(0,10);
            const todayCount = (groups.find(g => g.date === todayISO)?.tasks.length) || 0;
            return { total, inprog, todayCount };
        }

        function escapeHTML(str){
            return String(str).replace(/[&<>\"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[s]));
        }

        function render(groups, filters) {
            const container = $('#content');
            container.innerHTML = '';

            const q = (filters.q || '').trim().toLowerCase();
            const status = filters.status || '';
            const project = filters.project || '';
            const tag = filters.tag || '';

            const filteredGroups = groups.map(g => ({
                ...g,
                tasks: g.tasks.filter(t => {
                    const text = `${t.title}\n${t.notes}\n${(t.tags||[]).join(',')}`.toLowerCase();
                    const matchQ = !q || text.includes(q);
                    const matchS = !status || t.status === status;
                    const matchP = !project || (t.project || '') === project;
                    const matchT = !tag || (t.tags||[]).includes(tag);
                    return matchQ && matchS && matchP && matchT;
                })
            })).filter(g => g.tasks.length > 0);

            if (filteredGroups.length === 0) {
                container.innerHTML = `<div class="glass rounded-2xl p-10 text-center text-white">æ²¡æœ‰åŒ¹é…çš„ä»»åŠ¡</div>`;
                return;
            }

            filteredGroups.forEach((g, i) => {
                const section = document.createElement('section');
                section.className = 'glass rounded-2xl p-5 shadow-xl';
                section.innerHTML = `
                    <h2 class="text-xl md:text-2xl font-semibold text-white mb-4 flex items-center gap-2">
                        <span class="material-symbols-outlined">event</span>
                        ${formatDateCN(g.date)}
                    </h2>
                    <div class="space-y-4"></div>
                `;
                const list = section.querySelector('div.space-y-4');

                g.tasks.forEach((t, idx) => {
                    const badge = t.status === 'in-progress' ? ['è¿›è¡Œä¸­','bg-orange-100 text-orange-800','status-in-progress']
                                             : t.status === 'done' ? ['å·²å®Œæˆ','bg-green-100 text-green-800','status-done']
                                             : ['å¾…åŠ','bg-blue-100 text-blue-800','status-todo'];

                    const tagsHTML = (t.tags||[]).map(tag => `<span class="px-2 py-1 bg-brand-50 text-brand-700 text-xs rounded-full">${escapeHTML(tag)}</span>`).join('\n');
                    const projectHTML = t.project ? `<span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full">${escapeHTML(t.project)}</span>` : '';

                    const card = document.createElement('article');
                    card.className = `card rounded-xl p-5 shadow-md transition hover:-translate-y-0.5 ${badge[2]}`;
                    card.innerHTML = `
                        <div class="flex items-start justify-between gap-3">
                            <div class="flex-1">
                                <h3 class="font-semibold text-lg text-gray-800 mb-1">${escapeHTML(t.title)}</h3>
                                ${t.time ? `<div class=\"flex items-center text-sm text-gray-600 mb-2\"><span class=\"material-symbols-outlined mr-1 text-base\">schedule</span>${escapeHTML(t.time)}</div>` : ''}
                                ${t.notes ? `<p class=\"text-sm text-gray-600 mb-3 whitespace-pre-wrap\">${escapeHTML(t.notes)}</p>` : ''}
                                <div class="flex flex-wrap gap-2">
                                    <span class="px-2 py-1 ${badge[1]} text-xs rounded-full">${badge[0]}</span>
                                    ${projectHTML}
                                    ${tagsHTML}
                                </div>
                            </div>
                            <div class="flex items-center gap-1 shrink-0">
                                <button title="ç¼–è¾‘" class="p-2 rounded-lg hover:bg-gray-100 text-gray-500"><span class="material-symbols-outlined">edit</span></button>
                                <button title="åˆ é™¤" class="p-2 rounded-lg hover:bg-gray-100 text-gray-500"><span class="material-symbols-outlined">delete</span></button>
                            </div>
                        </div>
                    `;
                    list.appendChild(card);

                    if (window.motion) {
                        motion.animate(card, { opacity: [0,1], transform: ['translateY(6px)','translateY(0)'] }, { duration: 0.28, delay: (i*0.04)+(idx*0.02) });
                    }
                });

                container.appendChild(section);
                if (window.motion) motion.animate(section, { opacity: [0,1] }, { duration: 0.2, delay: i*0.02 });
            });

            if (window.__initLucide) window.__initLucide();
        }

        function populateFilters(groups){
            const projects = new Set();
            const tags = new Set();
            groups.forEach(g => g.tasks.forEach(t => {
                if (t.project) projects.add(t.project);
                (t.tags||[]).forEach(tags.add, tags);
            }));
            const projectSel = $('#project');
            const tagSel = $('#tag');
            projectSel.innerHTML = '<option value="">æ‰€æœ‰é¡¹ç›®</option>' + Array.from(projects).sort().map(p => `<option>${escapeHTML(p)}</option>`).join('');
            tagSel.innerHTML = '<option value="">æ‰€æœ‰æ ‡ç­¾</option>' + Array.from(tags).sort().map(t => `<option>${escapeHTML(t)}</option>`).join('');
        }

        function updateStats(groups){
            const { total, inprog, todayCount } = computeStats(groups);
            $('#stat-total').textContent = total;
            $('#stat-inprogress').textContent = inprog;
            $('#stat-today').textContent = todayCount;
        }

        function currentFilters(){
            return {
                q: $('#q').value,
                status: $('#status').value,
                project: $('#project').value,
                tag: $('#tag').value
            };
        }

    // åˆå§‹åŒ–
        let initialYaml = $('#todo-yaml').textContent.trim();
        let groups = parseYaml(initialYaml)
            .filter(Boolean)
            .sort((a,b) => a.date < b.date ? 1 : -1);

        ['q','status','project','tag'].forEach(id => {
            $('#' + id).addEventListener('input', () => render(groups, currentFilters()));
            $('#' + id).addEventListener('change', () => render(groups, currentFilters()));
        });
        $('#resetFilters').addEventListener('click', () => {
            $('#q').value = '';
            $('#status').value = '';
            $('#project').value = '';
            $('#tag').value = '';
            render(groups, currentFilters());
        });

        // YAML é¢æ¿
        const yamlTA = $('#yamlInput');
        yamlTA.value = initialYaml;
        $('#applyYaml').addEventListener('click', () => {
            try {
                const text = yamlTA.value;
                
                // æ¸…é™¤æ‰€æœ‰è¿‡æ»¤å™¨
                $('#q').value = '';
                $('#status').value = '';
                $('#project').value = '';
                $('#tag').value = '';
                
                const next = parseYaml(text).sort((a,b) => a.date < b.date ? 1 : -1);
                if (next.length === 0) {
                    alert('YAML æ•°æ®è§£æåä¸ºç©ºï¼Œè¯·æ£€æŸ¥æ ¼å¼');
                    return;
                }
                
                // å®Œå…¨æ›¿æ¢æ•°æ®ï¼Œç¡®ä¿æ²¡æœ‰æ®‹ç•™
                console.log(`åº”ç”¨ YAML - å½“å‰: ${groups.length} ç»„ï¼Œæ–°æ•°æ®: ${next.length} ç»„`);
                groups = [...next]; // ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ç¡®ä¿åˆ›å»ºæ–°æ•°ç»„
                
                updateStats(groups);
                populateFilters(groups);
                render(groups, currentFilters());
                initialYaml = text;
                updateDownloadLink(text);
                setSourceLabel('æ‰‹åŠ¨ç¼–è¾‘');
                
                console.log(`âœ… åº”ç”¨ YAML æˆåŠŸï¼Œå…± ${groups.length} ä¸ªæ—¥æœŸç»„ï¼Œ${groups.reduce((sum, g) => sum + g.tasks.length, 0)} ä¸ªä»»åŠ¡`);
            } catch (error) {
                console.error('åº”ç”¨ YAML å¤±è´¥:', error);
                alert('åº”ç”¨ YAML å¤±è´¥: ' + error.message);
            }
        });
        $('#restoreYaml').addEventListener('click', () => {
            try {
                const originalData = $('#todo-yaml').textContent.trim();
                yamlTA.value = originalData;
                
                // æ¸…é™¤æ‰€æœ‰è¿‡æ»¤å™¨
                $('#q').value = '';
                $('#status').value = '';
                $('#project').value = '';
                $('#tag').value = '';
                
                // åŒæ—¶æ¢å¤æ˜¾ç¤ºçš„æ•°æ®ï¼Œç¡®ä¿å®Œå…¨æ›¿æ¢
                const restored = parseYaml(originalData).sort((a,b) => a.date < b.date ? 1 : -1);
                console.log(`è¿˜åŸæ•°æ® - å½“å‰: ${groups.length} ç»„ï¼Œè¿˜åŸå: ${restored.length} ç»„`);
                groups = [...restored]; // ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ç¡®ä¿åˆ›å»ºæ–°æ•°ç»„
                
                updateStats(groups);
                populateFilters(groups);
                render(groups, currentFilters());
                updateDownloadLink(originalData);
                setSourceLabel('è¿˜åŸåˆ°å†…åµŒæ¡ˆä¾‹');
                
                console.log('âœ… å·²è¿˜åŸåˆ°åˆå§‹æ¡ˆä¾‹æ•°æ®');
            } catch (error) {
                console.error('è¿˜åŸæ•°æ®å¤±è´¥:', error);
                alert('è¿˜åŸæ•°æ®å¤±è´¥: ' + error.message);
            }
        });

    const initBlob = new Blob([initialYaml], { type: 'text/yaml;charset=utf-8' });
    $('#downloadYaml').href = URL.createObjectURL(initBlob);

        // â€”â€” æ•°æ®æºï¼šæœ¬åœ°æ–‡ä»¶ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
        const sourceLabel = $('#currentSource');

        function setSourceLabel(text){ sourceLabel && (sourceLabel.textContent = text); }
        function updateDownloadLink(text){
            const blob = new Blob([text], { type: 'text/yaml;charset=utf-8' });
            $('#downloadYaml').href = URL.createObjectURL(blob);
        }

        function loadFromFile(file){
            if (!file) return;
            const reader = new FileReader();
            reader.onload = () => {
                const text = String(reader.result || '');
                loadDataFromText(text, 'æœ¬åœ°æ–‡ä»¶');
            };
            reader.readAsText(file);
        }

        function loadDataFromText(text, source = 'æœªçŸ¥') {
            try {
                // æ¸…é™¤æ‰€æœ‰è¿‡æ»¤å™¨ï¼Œç¡®ä¿æ˜¾ç¤ºå…¨éƒ¨æ–°æ•°æ®
                $('#q').value = '';
                $('#status').value = '';
                $('#project').value = '';
                $('#tag').value = '';
                
                // è§£ææ–°çš„ YAML æ•°æ®
                const next = parseYaml(text).sort((a,b) => a.date < b.date ? 1 : -1);
                if (next.length === 0) {
                    console.warn(`ä» ${source} è§£æçš„æ•°æ®ä¸ºç©ºï¼Œä¿æŒå½“å‰æ•°æ®`);
                    alert(`ä» ${source} è§£æçš„æ•°æ®ä¸ºç©ºï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼`);
                    return;
                }
                
                // å®Œå…¨æ›¿æ¢æ•°æ®ï¼Œç¡®ä¿æ²¡æœ‰æ®‹ç•™
                console.log(`å‡†å¤‡æ›¿æ¢æ•°æ® - å½“å‰: ${groups.length} ç»„ï¼Œæ–°æ•°æ®: ${next.length} ç»„`);
                groups = [...next]; // ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ç¡®ä¿åˆ›å»ºæ–°æ•°ç»„
                
                updateStats(groups);
                populateFilters(groups);
                render(groups, currentFilters());
                $('#yamlInput').value = text;
                updateDownloadLink(text);
                setSourceLabel(source);
                
                console.log(`âœ… æˆåŠŸæ›¿æ¢æ•°æ®ä» ${source}ï¼Œå…± ${groups.length} ä¸ªæ—¥æœŸç»„ï¼Œ${groups.reduce((sum, g) => sum + g.tasks.length, 0)} ä¸ªä»»åŠ¡`);
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                alert('åŠ è½½æ•°æ®å¤±è´¥: ' + error.message);
            }
        }

        // ä»æŒ‡å®šè·¯å¾„è‡ªåŠ¨åŠ è½½æ–‡ä»¶
        async function loadFromPath(filePath) {
            try {
                // å¤„ç†ä¸åŒçš„è·¯å¾„æ ¼å¼
                let targetPath = filePath;
                
                // å¤„ç†ç›¸å¯¹è·¯å¾„å’Œç”¨æˆ·ç›®å½•
                if (filePath.startsWith('~/')) {
                    // åœ¨æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥è®¿é—®ç”¨æˆ·ç›®å½•
                    // æç¤ºç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©æ–‡ä»¶
                    console.log('æ£€æµ‹åˆ°ç”¨æˆ·ç›®å½•è·¯å¾„ï¼Œç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡ä»¶');
                    // ä¸æ˜¾ç¤ºå¼¹çª—ï¼Œåªåœ¨æ§åˆ¶å°è¾“å‡ºï¼Œé¿å…æ‰“æ–­ç”¨æˆ·ä½“éªŒ
                    console.warn('æ— æ³•è®¿é—®ç”¨æˆ·ç›®å½•è·¯å¾„:', filePath, 'è¯·ä½¿ç”¨æ–‡ä»¶é€‰æ‹©å™¨æ‰‹åŠ¨é€‰æ‹©æ–‡ä»¶');
                    return false;
                } else if (filePath.startsWith('./') || !filePath.startsWith('/')) {
                    // ç›¸å¯¹è·¯å¾„ï¼Œç›¸å¯¹äºå½“å‰é¡µé¢
                    targetPath = new URL(filePath, window.location.href).href;
                }
                
                console.log('å°è¯•ä»è·¯å¾„åŠ è½½æ–‡ä»¶:', targetPath);
                
                // å°è¯• fetch (ä»…é€‚ç”¨äºåŒæºæ–‡ä»¶æˆ–CORSå…è®¸çš„æ–‡ä»¶)
                const response = await fetch(targetPath);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const text = await response.text();
                loadDataFromText(text, `è·¯å¾„: ${filePath}`);
                return true;
            } catch (error) {
                console.warn('ä»è·¯å¾„åŠ è½½å¤±è´¥:', error.message);
                
                // å¦‚æœæ˜¯ç”¨æˆ·ç›®å½•è·¯å¾„ï¼Œç»™å‡ºæ›´å‹å¥½çš„æç¤º
                if (filePath.startsWith('~/')) {
                    console.log('æç¤ºï¼šæµè§ˆå™¨æ— æ³•ç›´æ¥è®¿é—®ç”¨æˆ·ç›®å½•ï¼Œè¯·ä½¿ç”¨æ–‡ä»¶é€‰æ‹©å™¨');
                }
                
                return false;
            }
        }

        // è‡ªåŠ¨åŠ è½½ï¼šä¼˜å…ˆä»è·¯å¾„ï¼Œå¤±è´¥åˆ™ä½¿ç”¨æ¡ˆä¾‹æ•°æ®
        async function autoLoadData() {
            const filePath = $('#localFilePath').value.trim();
            if (filePath) {
                console.log('å°è¯•ä»æŒ‡å®šè·¯å¾„åŠ è½½:', filePath);
                const success = await loadFromPath(filePath);
                if (success) {
                    console.log('æˆåŠŸä»è·¯å¾„åŠ è½½æ•°æ®');
                    return;
                }
                console.log('è·¯å¾„åŠ è½½å¤±è´¥ï¼Œå›é€€åˆ°æ¡ˆä¾‹æ•°æ®');
            }
            
            // å›é€€åˆ°æ¡ˆä¾‹æ•°æ®
            console.log('ä½¿ç”¨å†…åµŒæ¡ˆä¾‹æ•°æ®');
            const fallbackData = $('#todo-yaml').textContent.trim();
            
            // æ¸…é™¤è¿‡æ»¤å™¨
            $('#q').value = '';
            $('#status').value = '';
            $('#project').value = '';
            $('#tag').value = '';
            
            // ç¡®ä¿æ¸…é™¤ä¹‹å‰çš„æ•°æ®ï¼Œåªä½¿ç”¨æ¡ˆä¾‹æ•°æ®
            const fallback = parseYaml(fallbackData).sort((a,b) => a.date < b.date ? 1 : -1);
            console.log(`å›é€€åˆ°æ¡ˆä¾‹æ•°æ® - å½“å‰: ${groups.length} ç»„ï¼Œæ¡ˆä¾‹: ${fallback.length} ç»„`);
            groups = [...fallback]; // ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ç¡®ä¿åˆ›å»ºæ–°æ•°ç»„
            
            updateStats(groups);
            populateFilters(groups);
            render(groups, currentFilters());
            $('#yamlInput').value = fallbackData;
            updateDownloadLink(fallbackData);
            setSourceLabel('å†…åµŒæ¡ˆä¾‹');
        }

        // åˆå§‹åŒ–ï¼šæ˜¾ç¤ºå†…åµŒæ•°æ®
        setSourceLabel('åŠ è½½ä¸­...');
        populateFilters(groups);
        updateStats(groups);
        render(groups, currentFilters());

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨å°è¯•ä»è·¯å¾„è¯»å–
        window.addEventListener('load', () => {
            setTimeout(autoLoadData, 100); // å»¶è¿Ÿä¸€ç‚¹ç¡®ä¿DOMå®Œå…¨å‡†å¤‡å¥½
        });

        // æ•°æ®æºäº‹ä»¶
        const fileInput = $('#yamlFile');
        const pathInput = $('#localFilePath');
        const loadButton = $('#loadFromPath');
        
        fileInput && fileInput.addEventListener('change', (e) => {
            const file = e.target.files && e.target.files[0];
            if (file) {
                loadFromFile(file);
            }
        });

        loadButton && loadButton.addEventListener('click', () => {
            autoLoadData();
        });

        pathInput && pathInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                autoLoadData();
            }
        });
    </script>
</body>
</html>